#set($layout = "/admin/layout/default.vm")

<div class="row">
	<div class="col-lg-12">
        <h1 class="page-header">用户管理</h1>
    </div>
</div>
<div class="row">
	<div class="col-lg-12">
		<div class="panel panel-default">
            <!-- /.panel-heading -->
            <div class="panel-body">
				<form id="qForm" method="post">
					<input type="hidden" name="pn" value="${page.pageNo}" />
                </form>
				<table id="dataGrid" class="table table-striped table-bordered table-hover">
					<tr>
						<th class="text-center" style="width: 80px;">#</th>
						<th>用户名</th>
						<th>昵称</th>
						<th>邮箱</th>
						<th style="width: 55px;">状态</th>
                        <th class="text-center" style="width: 200px;">操作</th>
					</tr>
					#foreach($row in $page.results)
					<tr>
                        <td class="text-center">${row.id}</td>
                        <td>$!{row.username}</td>
						<td>$!{row.name}</td>
						<td>$!{row.email}</td>
						<td>
						#if($row.status == 0)
                            <span class="label label-success">启用</span>
						#else
							<span class="label label-default">禁用</span>
						#end
						</td>
                        <td class="text-center">
							#if(${row.status} == 0)
								<a href="javascript:void(0);" class="btn btn-danger btn-xs" data-id="${row.id}" data-action="close">停用</a>
							#else
								<a href="javascript:void(0);" class="btn btn-success btn-xs" data-id="${row.id}" data-action="open">激活</a>
							#end
							<a href="$base/admin/users/pwd?id=${row.id}" class="btn btn-primary btn-xs">修改密码</a>
						</td>
                    </tr>
					#end
				</table>
                <!-- /.table-responsive -->
				<div class="dataTables_paginate">
                	#page("home" $page 5)
                </div>
            </div>
            <!-- /.panel-body -->
        </div>
	</div>
</div>
<script type="text/javascript">
var J = jQuery;

function ajaxReload(json){
    if(json.code >= 0){
        if(json.message != null && json.message != ''){
            alert(json.message);
        }
        $('#qForm').submit();
    }else{
        alert(json.message);
    }
}

$(function() {
	// 停用
    $('#dataGrid a[data-action="close"]').bind('click', function(){
        if(confirm('该账号停用后，将不能登录系统，确定要停用？')){
            J.getJSON('$base/admin/users/close', {id: $(this).attr('data-id'), active: false}, ajaxReload);
        }
        return false;
    });
	
    // 激活
    $('#dataGrid a[data-action="open"]').bind('click', function(){
        if(confirm('该账号激活后，将可访问系统中的已授权功能，确定要激活？')){
            J.getJSON('$base/admin/users/open', {id: $(this).attr('data-id'), active: true}, ajaxReload);
        }
        return false;
    });
})
</script>