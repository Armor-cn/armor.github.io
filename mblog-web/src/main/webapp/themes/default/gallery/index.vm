#set($title="照片墙")

<div class="col-xs-12 col-md-12">
    <div id="blog-wrap" class="g-box masonry-grid">
    	#foreach($row in $page.results)
    	<div class="shadow-box g-item span_1_of_3 col masonry-entry">
    		#if($!{row.album})
        	<div class="g-thumb">
				<a href="$base/view/${row.id}">
					<img src="$base${row.album.preview}">
				</a>
        	</div>
    		#end
        	<h3 class="title">
				#postLink($row)
        	</h3>
        	<div class="g-outline">
        		<p>${row.summary}</p>
        	</div>
        	
        	<div class="g-btm">
                <div class="pull-left">
                    <div class="g-ava">
                        <img src="$base${row.author.avatar}"/>
                    </div>
                    <div class="caption"><time>$relDate.format($row.created)</time> 来自 <a href="$base/ta/${row.author.id}">#showName(${row.author})</a></div>
                </div>
    			<a class="cmt pull-right" href="javascript:void(0)" onclick="onFavor(this, '${row.id}')">喜欢&nbsp;(<i>${row.favors}</i>)</a>
        	</div>
        </div>
    	#end
    </div>
    <!-- #blog-wrap -->
    <div class="page-jump clr">
    	<div class="newer-posts alignleft"></div>
    	<div class="older-posts alignright">
    		<a href="$base/gallery_snippet/2?g=$!{groupId}">Older Posts &rarr;</a>
    	</div>
    </div>
</div>

<script type="text/javascript">

function onFavor(event, id) {
	var that = $(event);
	if (parseInt(id) > 0) {
		jQuery.getJSON('$base/post/favor.json', {'id': id}, function (ret) {
			if (ret.code >=0) {
				var favors = that.find('i').text();
				that.find('i').text(parseInt(favors) + 1);
			} else {
				layer.msg(ret.message, {icon: 5});
			}
		});
	}
}

</script>